<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parrilla Reencuentro C√∫pula IBK</title>
    
    <!-- Optimizaci√≥n para WhatsApp (Open Graph) -->
    <meta property="og:title" content="üî• Parrilla Reencuentro C√∫pula IBK">
    <meta property="og:description" content="Viernes 30 ENE | 5:00 PM | Confirma tu asistencia aqu√≠.">
    <meta property="og:image" content="https://images.unsplash.com/photo-1555939594-58d7cb561ad1?q=80&w=1000&auto=format&fit=crop">
    <!-- Si ya tienes tu link de Vercel, ponlo aqu√≠ para que la previsualizaci√≥n funcione mejor -->
    <meta property="og:url" content="https://cupula-ibk.vercel.app">
    <meta property="og:type" content="website">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #0f0f0f;
            color: #e5e7eb;
        }
        h1, h2, h3, h4 {
            font-family: 'Bebas Neue', cursive;
        }
        .bg-pattern {
            background-image: radial-gradient(#2a2a2a 1px, transparent 1px);
            background-size: 24px 24px;
        }
        .glass-panel {
            background: rgba(30, 30, 35, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        /* Loading Animation */
        .typing-indicator span {
            animation: blink 1.4s infinite both;
            height: 4px;
            width: 4px;
            background-color: currentColor;
            border-radius: 50%;
            display: inline-block;
            margin: 0 1px;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink {
            0% { opacity: 0.1; }
            20% { opacity: 1; }
            100% { opacity: 0.1; }
        }
        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: #1f2937; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
    </style>
</head>
<body class="bg-pattern min-h-screen flex items-center justify-center p-4">

    <div class="max-w-md w-full bg-[#121212] border border-gray-800 rounded-3xl shadow-2xl overflow-hidden relative mb-12">
        
        <!-- Hero Image -->
        <div class="h-56 bg-cover bg-center relative" style="background-image: url('https://images.unsplash.com/photo-1555939594-58d7cb561ad1?q=80&w=1000&auto=format&fit=crop');">
            <div class="absolute inset-0 bg-gradient-to-t from-[#121212] via-black/50 to-transparent flex items-end justify-center pb-6">
                <div class="text-center px-4">
                    <div class="inline-block border-2 border-orange-500 px-4 py-1 mb-2 transform -rotate-1 bg-black/40 backdrop-blur-sm">
                        <h1 class="text-5xl text-white tracking-widest leading-none drop-shadow-lg">PARRILLA</h1>
                    </div>
                    <h2 class="text-2xl text-orange-400 tracking-wide drop-shadow-md">REENCUENTRO C√öPULA IBK</h2>
                </div>
            </div>
        </div>

        <!-- Content Container -->
        <div class="px-6 pb-8 space-y-8 -mt-4 relative z-10">
            
            <!-- 1. Coordenadas -->
            <div class="space-y-3">
                <div class="flex items-center justify-between text-gray-300 text-sm font-bold uppercase tracking-widest mb-1">
                    <span>Coordenadas</span>
                    <span class="text-orange-500 text-xs">Viernes 30 ENE</span>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-gray-800/40 p-3 rounded-xl border border-gray-700/50 flex flex-col items-center justify-center text-center gap-1">
                        <i data-lucide="clock" class="text-orange-400 w-5 h-5 mb-1"></i>
                        <span class="text-xs text-gray-400 uppercase">Inicio</span>
                        <span class="font-bold text-white">5:00 PM</span>
                    </div>
                    <div class="bg-gray-800/40 p-3 rounded-xl border border-gray-700/50 flex flex-col items-center justify-center text-center gap-1">
                        <i data-lucide="moon" class="text-purple-400 w-5 h-5 mb-1"></i>
                        <span class="text-xs text-gray-400 uppercase">Fin</span>
                        <span class="font-bold text-white">02:00 AM</span>
                    </div>
                </div>

                <div class="flex items-start space-x-3 bg-gray-800/40 p-4 rounded-xl border border-gray-700/50">
                    <i data-lucide="map-pin" class="text-orange-500 w-5 h-5 mt-0.5 flex-shrink-0"></i>
                    <div class="flex-1">
                        <p class="text-xs text-gray-400 uppercase font-bold mb-0.5">Lugar</p>
                        <p class="font-semibold text-white leading-tight">Av. Arequipa 2651, Lince</p>
                        <p class="text-xs text-gray-500 mt-1">(Terraza)</p>
                    </div>
                    <a href="https://calendar.google.com/calendar/render?action=TEMPLATE&text=Parrilla+Reencuentro+C√∫pula+IBK&dates=20260130T220000Z/20260131T070000Z&details=Reencuentro+oficial.+Ver+detalles+de+comida+en+el+link.&location=Av.+Arequipa+2651,+Lince+(Terraza)" target="_blank" class="bg-blue-600/20 hover:bg-blue-600/40 text-blue-400 p-2 rounded-lg transition border border-blue-500/30">
                        <i data-lucide="calendar-plus" class="w-5 h-5"></i>
                    </a>
                </div>
            </div>

            <!-- 2. Log√≠stica (Info Est√°tica) -->
            <div class="glass-panel rounded-2xl p-5 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-16 h-16 bg-gradient-to-br from-yellow-500/10 to-transparent rounded-bl-full -mr-4 -mt-4"></div>
                
                <h3 class="text-xl text-yellow-500 mb-4 flex items-center gap-2">
                    <i data-lucide="clipboard-list" class="w-5 h-5"></i> Log√≠stica
                </h3>

                <!-- Aviso Tragos -->
                <div class="bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3 mb-3 flex gap-3 items-start">
                    <i data-lucide="beer" class="text-yellow-500 w-5 h-5 mt-0.5 flex-shrink-0"></i>
                    <div>
                        <p class="font-bold text-yellow-100 text-sm">Tragos</p>
                        <p class="text-xs text-gray-300 leading-relaxed">Cada uno lleva lo que quiere.</p>
                    </div>
                </div>
                
                <!-- Aviso Comida -->
                <div class="bg-orange-500/10 border border-orange-500/20 rounded-lg p-3 flex gap-3 items-start">
                    <i data-lucide="utensils" class="text-orange-500 w-5 h-5 mt-0.5 flex-shrink-0"></i>
                    <div>
                        <p class="font-bold text-orange-100 text-sm">Comida</p>
                        <p class="text-xs text-gray-300 leading-relaxed">Definimos por wsp si se pone una cuota o cada uno lleva algo.</p>
                    </div>
                </div>
            </div>

            <!-- 3. Confirmaci√≥n (GOOGLE SHEETS) -->
            <div class="glass-panel rounded-2xl p-5">
                <div class="flex items-center justify-between mb-4 border-b border-gray-700 pb-2">
                    <h3 class="text-xl text-green-400 flex items-center gap-2">
                        <i data-lucide="users" class="w-5 h-5"></i> Confirmados
                    </h3>
                    <button onclick="refreshList()" class="text-xs text-gray-500 hover:text-white transition" title="Actualizar lista">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                    </button>
                </div>
                
                <div class="flex gap-2 mb-4">
                    <input type="text" id="rsvpNameInput" placeholder="Tu Nombre..." class="bg-gray-900/80 border border-gray-700 text-white text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5 placeholder-gray-600">
                    <button onclick="submitRSVP()" id="btnSubmitRSVP" class="bg-green-600 hover:bg-green-700 text-white font-bold p-2.5 rounded-lg transition shadow-lg shadow-green-900/20 flex-shrink-0">
                        <i data-lucide="check" class="w-5 h-5"></i>
                    </button>
                </div>
                
                <ul id="attendeesList" class="custom-scroll max-h-40 overflow-y-auto space-y-2 pr-1">
                    <li class="text-center italic text-gray-600 text-xs py-2">Cargando lista...</li>
                </ul>
                
                <p class="text-[10px] text-gray-600 text-center mt-2 italic">Sincronizado con Google Sheets</p>
            </div>

            <!-- 4. Zona AI -->
            <div class="border border-purple-500/20 bg-purple-900/5 rounded-2xl p-5">
                <h3 class="text-lg text-purple-400 mb-2 flex items-center gap-2">
                    <i data-lucide="brain-circuit" class="w-4 h-4"></i> Zona AI: Datos Curiosos
                </h3>
                <p class="text-xs text-gray-400 mb-3">Impresiona a la gente con un dato random (Tech, 90s, Ciencia).</p>
                <button onclick="generateTopic()" id="btnTopic" class="w-full bg-purple-900/20 hover:bg-purple-800/40 border border-purple-500/30 text-purple-200 text-sm py-2.5 px-3 rounded-lg transition duration-300 flex items-center justify-center gap-2">
                    <span>üß† Lanzar Dato</span>
                </button>
                <div id="topicOutput" class="hidden mt-3 p-3 bg-black/40 rounded-lg text-sm text-gray-300 italic border-l-2 border-purple-500"></div>
            </div>

            <!-- Footer Actions -->
            <div class="pt-2 pb-6 space-y-3">
                <button onclick="copyMainInvite()" id="copyBtn" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3.5 px-4 rounded-xl transition duration-300 flex items-center justify-center gap-2 shadow-lg shadow-orange-900/20 active:scale-95">
                    <i data-lucide="share-2" class="w-5 h-5"></i> Copiar Link Amigable
                </button>
                
                <!-- Bot√≥n Admin (Solo aparece si configuras el link) -->
                <div id="adminPanel" class="hidden text-right">
                    <a id="adminLink" href="#" target="_blank" class="text-xs text-gray-600 hover:text-gray-400 transition flex items-center justify-end gap-1">
                        <i data-lucide="file-spreadsheet" class="w-3 h-3"></i> Ver Excel
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden Text -->
    <textarea id="inviteText" class="hidden">
üçª *C√öPULA IBK: REENCUENTRO* ü•©

Gente, se arm√≥ la parrilla oficial.
üìÖ *Viernes 30 ENE* | 5:00 PM
üìç *Lince (Terraza)*

üëâ *Ap√∫ntate en la lista aqu√≠:*
[LINK_DE_VERCEL_AQUI]

¬°Nos vemos! üî•
    </textarea>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        // ==========================================
        //  CONFIGURACI√ìN PARA VERCEL
        // ==========================================
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzjReNESEh3cI7xjOciJqgC5-zkww4MCeRyQ-qRYqTc84mgg48TDj-tq7tpIVnJU6Zy/exec"; 
        
        // --- NUEVO: LINK DE TU GOOGLE SHEET ---
        // Pega aqu√≠ el link de tu archivo de Google Sheets (la URL completa del navegador) 
        // para que te aparezca el bot√≥n de "Ver Excel" abajo.
        const LINK_DEL_EXCEL_PARA_TI = ""; 
        
        // Pega tu API Key de Gemini aqu√≠ abajo si quieres que funcione la IA en la web p√∫blica
        const YOUR_GEMINI_API_KEY = ""; 

        // ==========================================
        //  L√ìGICA DEL SISTEMA
        // ==========================================

        // Mostrar bot√≥n admin si hay link configurado
        if (LINK_DEL_EXCEL_PARA_TI) {
            document.getElementById('adminLink').href = LINK_DEL_EXCEL_PARA_TI;
            document.getElementById('adminPanel').classList.remove('hidden');
        }

        async function fetchAttendees() {
            try {
                // A√±adimos timestamp para evitar cach√©
                const timestamp = new Date().getTime();
                // IMPORTANTE: credentials: 'omit' evita problemas de cookies/auth de Google en iframes
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=get&t=${timestamp}`, {
                    method: "GET",
                    redirect: "follow",
                    credentials: 'omit',
                    headers: {
                        "Content-Type": "text/plain;charset=utf-8"
                    }
                });
                
                if (!response.ok) throw new Error("Error de red");

                const data = await response.json();
                
                const list = document.getElementById('attendeesList');
                list.innerHTML = '';

                if (!Array.isArray(data) || data.length === 0) {
                    list.innerHTML = '<li class="text-center italic text-gray-600 text-xs py-2">S√© el primero en confirmar...</li>';
                    return;
                }

                // Render list
                data.forEach(person => {
                    const li = document.createElement('li');
                    li.className = 'flex items-center gap-3 bg-gray-800/40 p-2.5 rounded-lg border border-gray-700/30';
                    const initial = person.name ? person.name.charAt(0).toUpperCase() : "?";
                    li.innerHTML = `
                        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-green-500 to-green-700 flex items-center justify-center text-xs font-bold shadow-lg shadow-green-900/30">
                            ${initial}
                        </div>
                        <span class="font-medium text-sm text-gray-200 truncate">${person.name}</span>
                    `;
                    list.appendChild(li);
                });
            } catch (e) {
                console.error("Fetch error:", e);
                const list = document.getElementById('attendeesList');
                // Enlace de respaldo por si falla la carga en preview
                list.innerHTML = `
                    <li class="text-center text-gray-500 text-xs py-2 space-y-2">
                         <span>‚ö†Ô∏è No se pudo cargar (bloqueo navegador).</span><br>
                        <a href="${GOOGLE_SCRIPT_URL}?action=get" target="_blank" class="underline text-blue-400 hover:text-blue-300">Ver lista oficial aqu√≠</a>
                    </li>`;
            }
        }

        async function submitRSVP() {
            const input = document.getElementById('rsvpNameInput');
            const name = input.value.trim();
            if (!name) return alert("Escribe tu nombre");

            const btn = document.getElementById('btnSubmitRSVP');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<div class="typing-indicator text-white"><span></span><span></span><span></span></div>';
            btn.disabled = true;

            try {
                // USANDO NO-CORS y credentials: omit para m√°xima compatibilidad
                await fetch(GOOGLE_SCRIPT_URL + "?action=add", {
                    method: "POST",
                    mode: 'no-cors', 
                    credentials: 'omit',
                    headers: {
                        "Content-Type": "text/plain;charset=utf-8"
                    },
                    body: JSON.stringify({ name: name, vote: "confirmado" })
                });
                
                input.value = '';
                btn.innerHTML = '<i data-lucide="check" class="w-5 h-5"></i>';
                
                setTimeout(() => {
                    fetchAttendees();
                    btn.innerHTML = originalHTML;
                    btn.disabled = false;
                    lucide.createIcons();
                }, 2000);

            } catch (e) {
                console.error("Error saving RSVP", e);
                alert("Hubo un error al conectar. Intenta abriendo el link directo.");
                btn.innerHTML = originalHTML;
                btn.disabled = false;
            }
        }

        function refreshList() {
            const list = document.getElementById('attendeesList');
            list.innerHTML = '<li class="text-center italic text-gray-600 text-xs py-2">Actualizando...</li>';
            fetchAttendees();
        }

        // --- AI LOGIC (GEMINI) ---
        window.generateTopic = async function() {
            const btn = document.getElementById('btnTopic');
            const output = document.getElementById('topicOutput');
            const originalContent = btn.innerHTML;

            btn.innerHTML = '<div class="typing-indicator text-purple-200"><span></span><span></span><span></span></div>';
            btn.disabled = true;
            output.classList.add('hidden');

            const prompt = "Genera un dato curioso sorprendente y breve (estilo 'Sab√≠as que...') que sea interesante para hombres de 30 a 35 a√±os. Temas sugeridos: tecnolog√≠a retro, ciencia, historia, cerveza, psicolog√≠a masculina, f√∫tbol o nostalgia de los 90. Solo el dato.";
            
            let activeApiKey = "";
            if (typeof YOUR_GEMINI_API_KEY !== 'undefined' && YOUR_GEMINI_API_KEY !== "") {
                activeApiKey = YOUR_GEMINI_API_KEY;
            }
            
            try {
                 const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${activeApiKey}`;
                 const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                if (!response.ok) throw new Error('API Error');
                const data = await response.json();
                const result = data.candidates?.[0]?.content?.parts?.[0]?.text || "Dato curioso no disponible.";
                
                output.innerText = `"${result}"`;
                output.classList.remove('hidden');
            } catch(e) {
                console.error(e);
                output.innerText = (activeApiKey === "") 
                    ? "‚ö†Ô∏è Configura tu API Key en el c√≥digo." 
                    : "Intenta de nuevo.";
                output.classList.remove('hidden');
            }
            btn.innerHTML = originalContent;
            btn.disabled = false;
            lucide.createIcons();
        }

        // Utils
        window.copyMainInvite = function() {
             const currentUrl = window.location.href.includes('http') ? window.location.href : "[LINK]";
             
             let text = document.getElementById('inviteText').value;
             text = text.replace("[LINK_DE_VERCEL_AQUI]", currentUrl);

             if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    const btn = document.getElementById('copyBtn');
                    const originalHTML = btn.innerHTML;
                    btn.innerHTML = '<i data-lucide="check" class="w-5 h-5"></i> ¬°Copiado!';
                    btn.classList.replace('bg-orange-600', 'bg-green-600');
                    btn.classList.replace('hover:bg-orange-700', 'hover:bg-green-700');
                    lucide.createIcons();
                    setTimeout(() => {
                        btn.innerHTML = originalHTML;
                        btn.classList.replace('bg-green-600', 'bg-orange-600');
                        btn.classList.replace('hover:bg-green-700', 'hover:bg-orange-700');
                        lucide.createIcons();
                    }, 2000);
                });
            } else {
                alert("Copia este texto:\n\n" + text);
            }
        }

        // INIT
        if (typeof lucide !== 'undefined') lucide.createIcons();
        window.onload = () => { 
            if (typeof lucide !== 'undefined') lucide.createIcons();
            fetchAttendees(); // Initial Load
        };
    </script>
</body>
</html>
